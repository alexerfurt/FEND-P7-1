function initMap(){if("object"==typeof google&&"object"==typeof google.maps){var e={lat:53.3405001,lng:-6.2362238};map=new google.maps.Map(document.getElementById("map"),{zoom:16,center:e}),ko.applyBindings(new ViewModel)}else googleError()}function googleError(){var e='<div class="location-text"><h3>Ouch! Unfortunately, Google Maps API could not be loaded. Please check your internet connection and reload the page.</h3></div>';document.getElementById("map").innerHTML=e}var map,createInfoWindow,infowindow,initialLocations=[{name:"Herbstreet",position:{lat:53.3443851,lng:-6.2376548},address:"Hanover Quay,Grand Canal Dock, Dublin 2",yelpID:"herbstreet-dublin-2"},{name:"Cafe Bar H",position:{lat:53.3435446,lng:-6.2388155},address:"Grand Canal Dock, Dublin 2",yelpID:"cafe-bar-h-dublin-2"},{name:"The Old Spot",position:{lat:53.3373286,lng:-6.2331933},address:"14 Bath Ave, Dublin 4",yelpID:"the-old-spot-dublin"},{name:"The Schoolhouse Bar & Restaurant",position:{lat:53.3374152,lng:-6.2394909},address:"2-8 Northumberland Rd, Dublin 4",yelpID:"the-schoolhouse-bar-and-restaurant-dublin"},{name:"The Ferryman",position:{lat:53.3460145,lng:-6.2407869},address:"35 Sir John Rogerson Quay, Dublin 2",yelpID:"ferryman-town-house-dublin"},{name:"Mamma Mia",position:{lat:53.339463,lng:-6.2436957},address:"2 Grattan St, Dublin 2",yelpID:"mamma-mia-dublin-2"},{name:"Osteria Lucio",position:{lat:53.340093,lng:-6.239316},address:"Clanwilliam terrace, Grand Canal Quay, Dublin 2",yelpID:"osteria-lucio-dublin"},{name:"Juniors Paulies Pizza",position:{lat:53.3374246,lng:-6.2346821},address:"58 Grand Canal Street Upper, Dublin 4",yelpID:"paulies-pizza-dublin"},{name:"The Press Cafe",position:{lat:53.3351826,lng:-6.2353551},address:"The Square, Dublin Southside, Dublin 4",yelpID:"press-cafe-dublin"}],Location=function(e){var n=this;this.name=e.name,this.position=e.position,this.address=e.address,this.yelpID=e.yelpID,this.marker=new google.maps.Marker({map:map,position:this.position,animation:google.maps.Animation.DROP,title:this.name,content:this.address,draggable:!0,visible:!0}),this.marker.addListener("click",function(){Location.prototype.setMarker(n),Location.prototype.getYelpData(n)})};Location.prototype.setMarker=function(e){var n=e;n.marker.setAnimation(google.maps.Animation.BOUNCE),setTimeout(function(){n.marker.setAnimation(null)},750)},Location.prototype.getYelpData=function(e){function n(){return Math.floor(1e12*Math.random()).toString()}var a=e,t="QgKzDi6crlpMCdWqbO6dFA",o="3RF38ZKFoQAKGL0G1K2VwkFRZ1DAz-mk",i="f8fSNbZvOseIXYlrsqbKqPlgYqo",r="WwALE3bHBsJNq3uRiX_TAPMOg9U",s=a.yelpID,l="http://api.yelp.com/v2/business/"+s,u={oauth_consumer_key:t,oauth_token:o,oauth_nonce:n(),oauth_timestamp:Math.floor(Date.now()/1e3),oauth_signature_method:"HMAC-SHA1",oauth_version:"1.0",callback:"cb",id:s},c=oauthSignature.generate("GET",l,u,i,r);u.oauth_signature=c,$.ajax({url:l,data:u,cache:!0,dataType:"jsonp",jsonpCallback:"cb",success:function(e){a.businesses=e,createInfoWindow(a,infoWindow)}}).fail(function(){alert("An error occurred: Yelp API call failed! Sorry about that. Please check your internet connection or try it again later.")})};var ViewModel=function(){var e=this;this.locationList=ko.observableArray([]),this.filter=ko.observable(""),initialLocations.forEach(function(n){e.locationList.push(new Location(n))}),infoWindow=new google.maps.InfoWindow,createInfoWindow=function(e,n){n.marker!=e.marker&&(n.marker=e.marker,n.setContent("<div><h4>"+e.marker.title+"</h4>"+e.marker.content+"</br>Phone:  "+e.businesses.phone+"</br></br>Yelp-Rating:  "+e.businesses.rating+'    <img src = "'+e.businesses.rating_img_url+'"/> '+e.businesses.review_count+" Reviews</br></br>Yelp-Review:  "+e.businesses.reviews[0].excerpt+"</div>"),n.open(map,e.marker),n.addListener("closeclick",function(){n.marker=null}))},this.currentLocation=function(){Location.prototype.setMarker(),Location.prototype.getYelpData()},this.filteredList=ko.computed(function(){var e=this.filter().toLowerCase();return ko.utils.arrayFilter(this.locationList(),function(n){var a=0===n.name.toLowerCase().indexOf(e);return n.marker.setVisible(a),a})},this)};