function initMap(){if("object"==typeof google&&"object"==typeof google.maps){var e={lat:53.3405001,lng:-6.2362238};map=new google.maps.Map(document.getElementById("map"),{zoom:16,center:e}),ko.applyBindings(new ViewModel)}else googleError()}function googleError(){var e='<div class="location-text"><h3>Ouch! Unfortunately, Google Maps API could not be loaded. Please check your internet connection and reload the page.</h3></div>';document.getElementById("map").innerHTML=e}var map,marker,initialLocations=[{name:"Herbstreet",position:{lat:53.3443851,lng:-6.2376548},address:"Hanover Quay,Grand Canal Dock, Dublin 2",yelpID:"herbstreet-dublin-2"},{name:"Cafe Bar H",position:{lat:53.3435446,lng:-6.2388155},address:"Grand Canal Dock, Dublin 2",yelpID:"cafe-bar-h-dublin-2"},{name:"The Old Spot",position:{lat:53.3373286,lng:-6.2331933},address:"14 Bath Ave, Dublin 4",yelpID:"the-old-spot-dublin"},{name:"The Schoolhouse Bar & Restaurant",position:{lat:53.3374152,lng:-6.2394909},address:"2-8 Northumberland Rd, Dublin 4",yelpID:"the-schoolhouse-bar-and-restaurant-dublin"},{name:"The Ferryman",position:{lat:53.3460145,lng:-6.2407869},address:"35 Sir John Rogerson Quay, Dublin 2",yelpID:"ferryman-town-house-dublin"},{name:"Mamma Mia",position:{lat:53.339463,lng:-6.2436957},address:"2 Grattan St, Dublin 2",yelpID:"mamma-mia-dublin-2"},{name:"Osteria Lucio",position:{lat:53.340093,lng:-6.239316},address:"Clanwilliam terrace, Grand Canal Quay, Dublin 2",yelpID:"osteria-lucio-dublin"},{name:"Juniors Paulies Pizza",position:{lat:53.3374246,lng:-6.2346821},address:"58 Grand Canal Street Upper, Dublin 4",yelpID:"paulies-pizza-dublin"},{name:"The Press Cafe",position:{lat:53.3351826,lng:-6.2353551},address:"The Square, Dublin Southside, Dublin 4",yelpID:"press-cafe-dublin"}],Location=function(e){this.name=e.name,this.position=e.position,this.address=e.address,this.yelpID=e.yelpID},ViewModel=function(){function e(e){function a(){return Math.floor(1e12*Math.random()).toString()}var t="QgKzDi6crlpMCdWqbO6dFA",i="3RF38ZKFoQAKGL0G1K2VwkFRZ1DAz-mk",r="f8fSNbZvOseIXYlrsqbKqPlgYqo",s="WwALE3bHBsJNq3uRiX_TAPMOg9U",l=e.yelpID,u="http://api.yelp.com/v2/business/"+l,c={oauth_consumer_key:t,oauth_token:i,oauth_nonce:a(),oauth_timestamp:Math.floor(Date.now()/1e3),oauth_signature_method:"HMAC-SHA1",oauth_version:"1.0",callback:"cb",id:l},m=oauthSignature.generate("GET",u,c,r,s);c.oauth_signature=m,$.ajax({url:u,data:c,cache:!0,dataType:"jsonp",jsonpCallback:"cb",success:function(a){e.businesses=a,o(e,n)},error:function(e){alert("An error occurred: "+e+"\nError: Yelp API call failed! Sorry about that. Please try it again later.")}}).fail(function(){console.log("Data could not be retrieved from Yelp API")})}var a=this;this.locationList=ko.observableArray([]),this.filter=ko.observable(),initialLocations.forEach(function(e){a.locationList.push(new Location(e))});var n=new google.maps.InfoWindow;a.locationList().forEach(function(a){marker=new google.maps.Marker({map:map,position:a.position,animation:google.maps.Animation.DROP,title:a.name,content:a.address,draggable:!0,visible:!0}),marker.addListener("click",function(){console.log(a),e(a)}),a.marker=marker});var o=function(e,a){a.marker!=e.marker&&(a.marker=e.marker,console.log(e),a.setContent("<div><h4>"+e.marker.title+"</h4>"+e.marker.content+"</br>Phone:  "+e.businesses.phone+"</br></br>Yelp-Rating:  "+e.businesses.rating+'    <img src = "'+e.businesses.rating_img_url+'"/> '+e.businesses.review_count+" Reviews</br></br>Yelp-Review:  "+e.businesses.reviews[0].excerpt+"</div>"),a.open(map,e.marker),setTimeout(function(){a.close(map,e.marker),a.marker=null},4e3),a.addListener("closeclick",function(){a.marker=null}))};this.currentLocation=ko.observable(this.locationList()[0]),this.filteredList=ko.computed(function(){var e=this.filter();return e?ko.utils.arrayFilter(this.locationList(),function(a){return 0===a.name.toLowerCase().indexOf(e)||0===a.name.indexOf(e)?(a.marker.setVisible(!0),!0):(a.marker.setVisible(!1),!1)}):ko.utils.arrayFilter(this.locationList(),function(e){return e.marker.setVisible(!0),!0})},this),this.setMarker=function(e){e.marker.setAnimation(google.maps.Animation.BOUNCE),setTimeout(function(){e.marker.setAnimation(null)},750),google.maps.event.trigger(e.marker,"click")}};